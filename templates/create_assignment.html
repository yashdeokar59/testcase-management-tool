{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 fw-bold text-dark mb-1">Create Assignment</h1>
        <p class="text-muted">Assign tasks to team members</p>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="title" class="form-label fw-semibold">Assignment Title</label>
                                <input type="text" class="form-control" id="title" name="title" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="priority" class="form-label fw-semibold">Priority</label>
                                <select class="form-select" id="priority" name="priority">
                                    <option value="Low">Low</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="High">High</option>
                                    <option value="Critical">Critical</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="assigned_to" class="form-label fw-semibold">Assign To</label>
                                <select class="form-select" id="assigned_to" name="assigned_to" required>
                                    <option value="">Select User</option>
                                    {% for user in users %}
                                    <option value="{{ user.id }}">{{ user.username }} ({{ user.role.title() }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="due_date" class="form-label fw-semibold">Due Date</label>
                                <input type="date" class="form-control" id="due_date" name="due_date">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="type" class="form-label fw-semibold">Assignment Type</label>
                                <select class="form-select" id="type" name="type">
                                    <option value="general" selected>General Task</option>
                                    <option value="test_case">Test Case</option>
                                    <option value="bug">Bug Fix</option>
                                    <option value="review">Review</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6" id="test_case_section" style="display: none;">
                            <div class="mb-3">
                                <label for="test_case_id" class="form-label fw-semibold">Test Case</label>
                                <select class="form-select" id="test_case_id" name="test_case_id">
                                    <option value="">Select Test Case</option>
                                    {% for test_case in test_cases %}
                                    <option value="{{ test_case.id }}">TC-{{ test_case.id }}: {{ test_case.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6" id="bug_section" style="display: none;">
                            <div class="mb-3">
                                <label for="bug_id" class="form-label fw-semibold">Bug</label>
                                <select class="form-select" id="bug_id" name="bug_id">
                                    <option value="">Select Bug</option>
                                    {% for bug in bugs %}
                                    <option value="{{ bug.id }}">BUG-{{ bug.id }}: {{ bug.title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label fw-semibold">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-tasks me-2"></i>Create Assignment
                        </button>
                        <a href="{{ url_for('assignments') }}" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">Assignment Tips</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        <small>Be specific about what needs to be done</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-clock text-info me-2"></i>
                        <small>Set realistic due dates</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-user text-success me-2"></i>
                        <small>Assign to the right person for the task</small>
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-flag text-danger me-2"></i>
                        <small>Set appropriate priority levels</small>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('type').addEventListener('change', function() {
    const testCaseSection = document.getElementById('test_case_section');
    const bugSection = document.getElementById('bug_section');
    
    // Hide all sections first
    testCaseSection.style.display = 'none';
    bugSection.style.display = 'none';
    
    // Show relevant section
    if (this.value === 'test_case') {
        testCaseSection.style.display = 'block';
    } else if (this.value === 'bug') {
        bugSection.style.display = 'block';
    }
});
</script>
{% endblock %}
